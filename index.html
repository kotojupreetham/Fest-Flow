<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fest Flow | Live Event</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --primary: #6610f2;
            --accent: #20c997;
        }

        body {
            margin: 0;
            overflow-x: hidden;
            background: linear-gradient(120deg, #0d6efd, #6610f2, #20c997);
            background-size: 300% 300%;
            color: #fff;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        /* Admin Controls */
        .admin-nav {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .btn-google {
            background: white;
            color: #444;
            border-radius: 50px;
            padding: 8px 20px;
            font-weight: 600;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .btn-google:hover {
            transform: scale(1.05);
            background: #f8f9fa;
        }

        header {
            backdrop-filter: blur(14px);
            background: rgba(0, 0, 0, 0.25);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .horizontal-section {
            height: 100vh;
            display: flex;
            align-items: center;
            overflow: hidden;
        }

        .horizontal-wrapper {
            display: flex;
            gap: 48px;
            padding: 0 12vw;
        }

        .event-card {
            min-width: 360px;
            background: rgba(255, 255, 255, 0.96);
            color: #222;
            border-radius: 22px;
            overflow: hidden;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.35);
            opacity: 0;
            transform: translateY(60px);
            transition: transform 0.4s ease, box-shadow 0.4s ease;
        }

        .event-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 35px 80px rgba(0, 0, 0, 0.45);
        }

        .card-img {
            width: 100%;
            height: 210px;
            object-fit: cover;
            background: linear-gradient(120deg, #ddd, #f5f5f5);
        }

        .card-body { padding: 22px; }
        .event-title { font-weight: 700; color: var(--primary); font-size: 1.15rem; line-height: 1.3; }
        #loader { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(10px); z-index: 999; color: #fff; }
        footer { background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px); }

        @media (max-width: 768px) {
            .event-card { min-width: 300px; }
            .horizontal-wrapper { padding: 0 8vw; gap: 32px; }
        }
    </style>
</head>

<body>

    <div id="loader">ðŸš€ Loading Live Events...</div>

    <div class="admin-nav" id="authUI">
        <button id="loginBtn" class="btn-google">Admin Login</button>
    </div>

    <header class="text-white text-center py-5">
        <h1 class="display-4 fw-bold">Fest Flow</h1>
        <p class="opacity-75">Live Event Management System</p>
    </header>

    <section class="horizontal-section">
        <div class="horizontal-wrapper" id="eventContainer"></div>
    </section>

    <footer class="text-center py-4">
        <p class="opacity-75 mb-0">&copy; 2025 Fest Flow | K Preetham</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
        // Added Auth Imports
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDLwOECnCBLKaM81XAPkPWNncJnb6VYLUo",
            authDomain: "festflow-10d5c.firebaseapp.com",
            projectId: "festflow-10d5c",
            storageBucket: "festflow-10d5c.appspot.com",
            messagingSenderId: "196497248283",
            appId: "1:196497248283:web:b4a10ed59b221870dca8be"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        const ADMIN_UID = "rTFKeYgo6sX65isgGc5mvaEY3BI3";

        // --- Auth Logic ---
        const authUI = document.getElementById("authUI");
        const loginBtn = document.getElementById("loginBtn");

        loginBtn.addEventListener("click", () => {
            signInWithPopup(auth, provider).catch(err => console.error("Login Error", err));
        });

        // --- Inside your <script type="module"> in the main file ---

// --- Inside index.html <script type="module"> ---

        onAuthStateChanged(auth, (user) => {
            if (user) {
                if (user.uid === ADMIN_UID) {
                    // Redirect to the dashboard file in your GitHub repo
                    window.location.href = "dashboard.html"; 
                } else {
                    alert("Unauthorized. Access Denied.");
                    signOut(auth);
                }
            } else {
                authUI.innerHTML = `<button id="loginBtn" class="btn-google">Admin Login</button>`;
                document.getElementById("loginBtn").onclick = () => signInWithPopup(auth, provider);
            }
        });

        // --- Data Fetching Logic ---
        async function initApp() {
            const container = document.getElementById("eventContainer");
            const loader = document.getElementById("loader");

            try {
                const eventsSnapshot = await getDocs(collection(db, "events"));

                for (const eventDoc of eventsSnapshot.docs) {
                    const eventId = eventDoc.id;
                    const docRef = doc(db, "events", eventId, "details", "event");
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        const raw = docSnap.data();
                        const key = Object.keys(raw)[0];
                        const ev = raw[key];

                        renderCard({
                            title: ev.title,
                            desc: ev.description,
                            category: ev.category,
                            age: ev.ageLimit,
                            img: ev.image || "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=800",
                            code: ev.eventCode,
                            type: ev.type
                        });
                    }
                }
                loader.style.display = "none";
                startGSAP();
            } catch (err) {
                loader.innerText = "Failed to load events.";
                console.error(err);
            }
        }

        function renderCard(ev) {
            const container = document.getElementById("eventContainer");
            let finalImg = ev.img;
            if (!ev.img || ev.img.trim() === "" || ev.img.includes("linkedin.com/pulse")) {
                finalImg = "https://via.placeholder.com/400x200?text=Fest+Flow";
            }

            const div = document.createElement("div");
            div.className = "event-card";
            div.innerHTML = `
                <img src="${finalImg}" class="card-img" onerror="this.src='https://via.placeholder.com/400x200?text=Fest+Flow'">
                <div class="card-body">
                    <span class="badge bg-primary mb-2">${ev.type}</span>
                    <h5 class="event-title">${ev.title}</h5>
                    <p style="font-size:0.85rem; color:#666; height: 65px; overflow: hidden;">${ev.desc}</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-muted"><strong>Code:</strong> ${ev.code}</small>
                        <span class="badge bg-light text-dark border">${ev.category}</span>
                    </div>
                </div>
            `;
            container.appendChild(div);
        }

        function startGSAP() {
            gsap.registerPlugin(ScrollTrigger);
            gsap.to("body", {
                backgroundPosition: "300% 300%",
                duration: 20,
                repeat: -1,
                yoyo: true,
                ease: "linear"
            });

            gsap.to(".event-card", {
                opacity: 1,
                y: 0,
                duration: 1,
                ease: "power3.out",
                stagger: 0.25,
                scrollTrigger: {
                    trigger: ".horizontal-section",
                    start: "top 85%"
                }
            });

            const wrapper = document.querySelector(".horizontal-wrapper");
            gsap.to(wrapper, {
                x: () => -(wrapper.scrollWidth - window.innerWidth + 150),
                ease: "none",
                scrollTrigger: {
                    trigger: ".horizontal-section",
                    start: "top top",
                    end: () => "+=" + wrapper.scrollWidth,
                    scrub: 1,
                    pin: true,
                    invalidateOnRefresh: true
                }
            });
        }

        initApp();
    </script>
</body>
</html>



